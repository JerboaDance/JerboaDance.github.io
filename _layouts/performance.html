<!DOCTYPE html>
<html>
    {% capture title %}Jerboa Dance - {{page.name}}{% endcapture %}
    {% include head-tag.html title=title %}
    <body>
        <div class="wrapper">
            {% include header.html %}
            {% include nav.html %}

            {% capture gallerypath %}/assets{{page.id}}{% endcapture %}            
            <div class="header-image"><img src="{{ gallerypath }}/header.jpg" alt="Photograph of {{ page.name }} performance"/></div>
        
            <div class="content">
                <h1>{{ page.name }}</h1>

                {% if page.upcoming-show %}
                    <h2 class="show-dates">{{page.upcoming-show.dates}}</h2>
                    {% include venue.html show=page.upcoming-show %}
                    <div class="description">{{ content }}</div>
                    {% include castlist.html show=page.upcoming-show%}
                    {% include buytickets.html show=upcoming-performance.upcoming-show%}
                {% else %}
                    <div class="description">{{ content }}</div>
                {% endif %}
                
                <div class="prior-show-dates">
                    {% if page.prior-shows.size > 0 and page.upcoming-show %}
                        <h2>Prior Shows</h2>
                    {% endif %}
                    
                    {% for show in page.prior-shows %}
                        <h2 class="show-dates">{{show.dates}}</h2>
                        {% include venue.html show=show %}
                        {% include castlist.html show=show %}
                    {% endfor %}
                </div>

                {% include galleryoverlay.html %}
                <photo-gallery>
                    {% for photograph in page.photographs %}{% unless photograph.id == "header" %}
                    <div>
                        {% capture src %}{{ gallerypath }}/{{photograph.id}}.jpg{% endcapture %}
                        <a href="{{src}}" class="gallery-item">
                            <img src="{{src}}" alt="Photograph of {{ page.name }} performance"/>
                        </a>
                        {% if photograph.featured %}
                        <div class="featured">
                            <h3>Featured</h3>
                            <ul>
                            {% for featured in photograph.featured %}
                                {% assign person = page.upcoming-show.highlights | where: "name", featured | first %}
                                {% unless person %}
                                    {% for show in page.prior-shows %}
                                        {% assign person = show.highlights | where: "name", featured | first %}
                                        {% if person %}{% break %}{% endif %}
                                    {% endfor %}
                                {% endunless %}
                                {% unless person %}
                                    {% capture personpath %}/company/{{featured}}{% endcapture %}
                                    {% assign person = site.company | where: "id", personpath | first %}
                                {% endunless %}
                                
                                <li>{% include person-element.html person=person id=featured %}</li>
                            {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if photograph.attribution %}
                        {% assign photographer-url = site.data.photographers[photograph.attribution] %}
                        <div class="attribution">{% include person-element.html id=photograph.attribution url=photographer-url %}</div>
                        {% endif %}

                    </div>
                    {% endunless %}{% endfor %}
                </photo-gallery>
            </div><!-- /.content -->
            
            {% include footer.html %}

        </div><!-- ./wrapper -->
    </body>
</html>